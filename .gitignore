import { sqlToFeeType } from '#core/helpers/sqlFeeTypeMap.js';

async #getPackageDataFromCurrentSQL(cifno) {
  const conn  = await connectToFeeMgmtDb();
  const rows  = await executeStoreProcedure(conn, 'sp_GetConductorFees', { CIF: cifno });
  if (!rows?.length) return [];

  return rows.map(r => ({
    cifno:          r.CIFNO?.trim(),
    ddaNumber:      String(r.DDANumber).trim(),
    feeType:        sqlToFeeType(r),          // <<< aqui!
    feeDescription: r.FeeDescription?.trim() || '',
    feeCode:        r.FeeCode?.trim()        || '',
    bpsFeeTypeCode: r.BPSFeeTypeCode?.trim() || '',
    feeAmount:      Number(r.FeeAmount),
    source:         r.Source?.trim()         || '',
    entity:         r.Entity?.trim()         || '',
    isFeesStandard: r.IsFeesStandard?.trim() || '',
    feeGroup:       1,                       // se precisar de grupo extra, calcule aqui
  }));
}
