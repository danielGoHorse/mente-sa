/* ---------------------------------------------------------------------------
 *  Gera todas as opções de Equity / Options  (campo 7)
 * -------------------------------------------------------------------------*/
function mergeEquityOptionAll(excRows) {
  // 1. mantém SOMENTE as linhas visíveis e não aposentadas
  const equities = excRows.filter(
    r => r.FeeCode === 'BPS004' && r.Visible === true  && r.Retired === false
  );
  const options  = excRows.filter(
    r => r.FeeCode === 'BPS005' && r.Visible === true  && r.Retired === false
  );

  // 2. códigos (Amount) distintos que restaram
  const allCodes = Array.from(new Set([...equities, ...options].map(r => r.Amount)));

  // 3. monta a lista combinada
  const result = allCodes.sort().map(code => {
    const equity = equities.find(r => r.Amount === code);
    const option = options .find(r => r.Amount === code);

    return {
      value  : code,
      text   :
        `${code} - ` +
        `Equity:${equity?.FreqDescription?.trim() ?? '-'}` +
        `; Option:${option?.FreqDescription?.trim() ?? '-'}`,
      visible: true,   // já garantimos que é visível
      retired: false,  // já garantimos que NÃO está aposentado
    };
  });

  // 4. entrada “Other” (sempre disponível)
  result.push({
    value  : '',
    text   : 'Other',
    visible: true,
    retired: false,
  });

  return result;
}
