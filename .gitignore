/* helper p/ Equity + Option  ───────────── */
function mergeEquityOption(rows) {
  /*
   * 1) agrupa pelo próprio código (Amount) – “A1”, “B6”…;
   * 2) junta a descrição de Equity e/ou Option que existir;
   * 3) mantém a ordem alfabética.
   */
  const bucket = {};
  for (const r of rows) {
    const code = r.Amount;                       // chave = código
    (bucket[code] ??= { E: null, O: null });
    if (r.BPSFeeTypeCode === 'E') bucket[code].E = r;
    if (r.BPSFeeTypeCode === 'O') bucket[code].O = r;
  }

  return Object.keys(bucket)
    .sort((a, b) => a.localeCompare(b))
    .map(code => {
      const { E, O } = bucket[code];
      return {
        value  : code,                           // “A1”, “B6”…
        text   : `${code} - ` +
                 `Equity:${E ? E.FreqDescription : '-' }; ` +
                 `Option:${O ? O.FreqDescription : '-'}`,
        visible: true,
        retired: false
      };
    });
}
