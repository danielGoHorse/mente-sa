/* ------------------------------------------------------------------ *
 *  NOVAS FUNÇÕES PRIVADAS                                            *
 * ------------------------------------------------------------------ */

// 1 ─ consulta rápida no SQL e devolve o id do pacote (1, 2 ou 3)
async #getDefaultFeePackageIdFromSQL (cifno) {
  const conn = await connectToFeeMgmtDb();
  const data = await executeStoreProcedure(
    conn,
    'sp_get_fees_byCIF',        // ← usa o mesmo SP e pega só a 1ª linha
    { cifno }
  );
  if (!data || data.length === 0) return null;
  return data[0]['Default Fee Package Id'] ?? null;
}

// 2 ─ converte id → URL usando a config carregada no bootstrap
#getDocumentUrl (feePackageId) {
  const urls = global.environment.scheduleUrls || {};
  const key  = { 1: 'intlPB3', 2: 'uSPBIndividual3', 3: 'uSPBCorporation3' }[feePackageId];
  return key ? urls[key] || '' : '';
}

/* ------------------------------------------------------------------ *
 *  DENTRO DO execute() — logo antes do return                        *
 * ------------------------------------------------------------------ */

const feePackageId = await this.#getDefaultFeePackageIdFromSQL(customerAccount[0].cifno);
result.documentUrl = this.#getDocumentUrl(feePackageId);

/* ------------------------------------------------------------------ */
