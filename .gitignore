// imports no topo
import { useMemo, useEffect } from "react";
import { UploadedDocument } from "@/app/store/types";
import { useDocumentStore } from "@/app/store/documentsStore/documentStore";

// ... dentro do componente PageTabs, depois que você já tem const { data } = getRequestConfig;
const { documentList, setDocumentList } = useDocumentStore((s) => s);

// 1) Monta a lista vinda do backend
const docsFromBackend = useMemo<UploadedDocument[]>(() => {
  if (!data?.documents?.content?.length) return [];

  return data.documents.content.map((path: string) => {
    const [uuid, ...rest] = path.split("/");
    const name = rest.join("/");

    // Se você NÃO precisa de URL assinada (ou já tem uma rota pública), gere aqui.
    // Caso tenha uma rota /v1/file/link, pode simplesmente deixar serverUrlSigned undefined
    // e o preview/download usarão serverPath para gerar o link depois.
    return {
      serverPath: path,
      documentUUID: uuid,
      documentName: name,
      createdAt: data.createdAt ?? new Date().toISOString(),
      uploadedBy: { fullName: data.createdBy, userId: data.createdBy },
      documentStatus: "uploaded",
      // opcional: se tiver como montar direto
      // serverUrlSigned: `${process.env.NEXT_PUBLIC_FILE_HOST}/${path}`
    };
  });
}, [data]);

// 2) Hidrata o store uma única vez
useEffect(() => {
  if (documentList.length === 0 && docsFromBackend.length > 0) {
    setDocumentList(docsFromBackend);
  }
}, [documentList.length, docsFromBackend, setDocumentList]);
