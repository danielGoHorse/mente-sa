{
    "code": 200,
    "data": {
        "fees": [
            {
                "feeType": "Customer Fees",
                "feeGroups": [
                    {
                        "name": "Standard Fees",
                        "code": 1,
                        "fields": [
                            {
                                "code": 1,
                                "name": "Account Maintenance Fee",
                                "defaultValue": "25",
                                "tooltip": "Monthly - Charged Quarterly",
                                "isException": false,
                                "exceptionOptions": [],
                                "labelValue": "$25.00"
                            },
                            {
                                "code": 2,
                                "name": "Hold Mail Fee",
                                "defaultValue": "",
                                "tooltip": "Annual - Charged Annual",
                                "isException": false,
                                "exceptionOptions": [],
                                "labelValue": "$0.00"
                            }
                        ],
                        "kycMailingStatus": "Standard",
                        "cif": "F016583",
                        "accountNumber": 7115342
                    },
                    {
                        "name": "Client Current Fees",
                        "code": 2,
                        "fields": [
                            {
                                "code": 1,
                                "name": "Account Maintenance Fee",
                                "defaultValue": "",
                                "tooltip": "",
                                "isException": false,
                                "exceptionOptions": []
                            },
                            {
                                "code": 2,
                                "name": "Hold Mail Fee",
                                "defaultValue": "",
                                "tooltip": "",
                                "isException": false,
                                "exceptionOptions": []
                            }
                        ],
                        "cif": "F016583",
                        "accountNumber": 7115342
                    },
                    {
                        "name": "Exceptions Request",
                        "code": 3,
                        "fields": [
                            {
                                "code": 1,
                                "name": "Account Maintenance Fee",
                                "defaultValue": "0",
                                "tooltip": "",
                                "isException": true,
                                "exceptionOptions": [
                                    {
                                        "code": 1,
                                        "name": "Account Maintenance Fee",
                                        "defaultValue": "0",
                                        "tooltip": "",
                                        "isException": true
                                    }
                                ],
                                "labelValue": ""
                            }
                        ],
                        "cif": "F016583",
                        "accountNumber": 7115342
                    }
                ]
            },
            {
                "feeType": "Bank Account Fees",
                "feeGroups": [
                    {
                        "name": "Standard Fees",
                        "code": 1,
                        "fields": [
                            {
                                "code": 4,
                                "isStandard": false,
                                "isCurrentClient": false,
                                "isException": false,
                                "name": "FX Outgoing Wire Fee",
                                "defaultValue": "25",
                                "hasChanged": false,
                                "tooltip": "",
                                "exceptionOptions": [],
                                "_id": "67aa5655c431372c57030e53"
                            },
                            {
                                "code": 4,
                                "isStandard": false,
                                "isCurrentClient": false,
                                "isException": false,
                                "name": "FX Outgoing Wire Fee",
                                "defaultValue": "",
                                "hasChanged": false,
                                "tooltip": "",
                                "exceptionOptions": [],
                                "_id": "67aa5655c431372c57030e54"
                            },
                            {
                                "code": 4,
                                "isStandard": false,
                                "isCurrentClient": false,
                                "isException": false,
                                "name": "FX Outgoing Wire Fee",
                                "defaultValue": "",
                                "hasChanged": false,
                                "tooltip": "",
                                "exceptionOptions": [],
                                "_id": "67aa5655c431372c57030e55"
                            },
                            {
                                "code": 4,
                                "isStandard": false,
                                "isCurrentClient": false,
                                "isException": false,
                                "name": "FX Outgoing Wire Fee",
                                "defaultValue": "25",
                                "hasChanged": false,
                                "tooltip": "",
                                "exceptionOptions": [],
                                "_id": "67aa5655c431372c57030e56"
                            }
                        ],
                        "cif": "F016583",
                        "accountNumber": "7113617",
                        "visible": true,
                        "kycMailingStatus": null,
                        "_id": "67aa5655c431372c57030e52"
                    },
                    {
                        "name": "Client Current Fees",
                        "code": 2,
                        "fields": [
                            {
                                "code": 4,
                                "isStandard": false,
                                "isCurrentClient": false,
                                "isException": false,
                                "name": "FX Outgoing Wire Fee",
                                "defaultValue": "",
                                "hasChanged": false,
                                "tooltip": "",
                                "exceptionOptions": [],
                                "_id": "67aa5655c431372c57030e67"
                            },
                            {
                                "code": 4,
                                "isStandard": false,
                                "isCurrentClient": false,
                                "isException": false,
                                "name": "FX Outgoing Wire Fee",
                                "defaultValue": "",
                                "hasChanged": false,
                                "tooltip": "",
                                "exceptionOptions": [],
                                "_id": "67aa5655c431372c57030e68"
                            },
                            {
                                "code": 4,
                                "isStandard": false,
                                "isCurrentClient": false,
                                "isException": false,
                                "name": "FX Outgoing Wire Fee",
                                "defaultValue": "",
                                "hasChanged": false,
                                "tooltip": "",
                                "exceptionOptions": [],
                                "_id": "67aa5655c431372c57030e69"
                            },
                            {
                                "code": 4,
                                "isStandard": false,
                                "isCurrentClient": false,
                                "isException": false,
                                "name": "FX Outgoing Wire Fee",
                                "defaultValue": "",
                                "hasChanged": false,
                                "tooltip": "",
                                "exceptionOptions": [],
                                "_id": "67aa5655c431372c57030e6a"
                            }
                        ],
                        "cif": "F016583",
                        "accountNumber": "7113617",
                        "visible": true,
                        "kycMailingStatus": null,
                        "_id": "67aa5655c431372c57030e66"
                    },
                    {
                        "name": "Exceptions Request",
                        "code": 3,
                        "fields": [
                            {
                                "code": 4,
                                "isStandard": false,
                                "isCurrentClient": false,
                                "isException": true,
                                "name": "FX Outgoing Wire Fee",
                                "defaultValue": "0",
                                "hasChanged": false,
                                "tooltip": "",
                                "exceptionOptions": [
                                    {
                                        "retired": false,
                                        "visible": true,
                                        "approvedByDoubleA": null,
                                        "_id": "67aa5655c431372c57030e78"
                                    }
                                ],
                                "_id": "67aa5655c431372c57030e77",
                                "labelValue": ""
                            }
                        ],
                        "cif": "F016583",
                        "accountNumber": "7113617",
                        "visible": true,
                        "kycMailingStatus": null,
                        "_id": "67aa5655c431372c57030e76"
                    },
                    {
                        "name": "Standard Fees",
                        "code": 1,
                        "fields": [
                            {
                                "code": 4,
                                "isStandard": false,
                                "isCurrentClient": false,
                                "isException": false,
                                "name": "FX Outgoing Wire Fee",
                                "defaultValue": "25",
                                "hasChanged": false,
                                "tooltip": "",
                                "exceptionOptions": [],
                                "_id": "67aa5655c431372c57030e49"
                            },
                            {
                                "code": 4,
                                "isStandard": false,
                                "isCurrentClient": false,
                                "isException": false,
                                "name": "FX Outgoing Wire Fee",
                                "defaultValue": "",
                                "hasChanged": false,
                                "tooltip": "",
                                "exceptionOptions": [],
                                "_id": "67aa5655c431372c57030e4a"
                            },
                            {
                                "code": 4,
                                "isStandard": false,
                                "isCurrentClient": false,
                                "isException": false,
                                "name": "FX Outgoing Wire Fee",
                                "defaultValue": "",
                                "hasChanged": false,
                                "tooltip": "",
                                "exceptionOptions": [],
                                "_id": "67aa5655c431372c57030e4b"
                            },
                            {
                                "code": 4,
                                "isStandard": false,
                                "isCurrentClient": false,
                                "isException": false,
                                "name": "FX Outgoing Wire Fee",
                                "defaultValue": "25",
                                "hasChanged": false,
                                "tooltip": "",
                                "exceptionOptions": [],
                                "_id": "67aa5655c431372c57030e4c"
                            }
                        ],
                        "cif": "F016583",
                        "accountNumber": "7115342",
                        "visible": true,
                        "kycMailingStatus": null,
                        "_id": "67aa5655c431372c57030e48"
                    },
                    {
                        "name": "Client Current Fees",
                        "code": 2,
                        "fields": [
                            {
                                "code": 4,
                                "isStandard": false,
                                "isCurrentClient": false,
                                "isException": false,
                                "name": "FX Outgoing Wire Fee",
                                "defaultValue": "",
                                "hasChanged": false,
                                "tooltip": "",
                                "exceptionOptions": [],
                                "_id": "67aa5655c431372c57030e5d"
                            },
                            {
                                "code": 4,
                                "isStandard": false,
                                "isCurrentClient": false,
                                "isException": false,
                                "name": "FX Outgoing Wire Fee",
                                "defaultValue": "",
                                "hasChanged": false,
                                "tooltip": "",
                                "exceptionOptions": [],
                                "_id": "67aa5655c431372c57030e5e"
                            },
                            {
                                "code": 4,
                                "isStandard": false,
                                "isCurrentClient": false,
                                "isException": false,
                                "name": "FX Outgoing Wire Fee",
                                "defaultValue": "",
                                "hasChanged": false,
                                "tooltip": "",
                                "exceptionOptions": [],
                                "_id": "67aa5655c431372c57030e5f"
                            },
                            {
                                "code": 4,
                                "isStandard": false,
                                "isCurrentClient": false,
                                "isException": false,
                                "name": "FX Outgoing Wire Fee",
                                "defaultValue": "",
                                "hasChanged": false,
                                "tooltip": "",
                                "exceptionOptions": [],
                                "_id": "67aa5655c431372c57030e60"
                            }
                        ],
                        "cif": "F016583",
                        "accountNumber": "7115342",
                        "visible": true,
                        "kycMailingStatus": null,
                        "_id": "67aa5655c431372c57030e5c"
                    },
                    {
                        "name": "Exceptions Request",
                        "code": 3,
                        "fields": [
                            {
                                "code": 4,
                                "isStandard": false,
                                "isCurrentClient": false,
                                "isException": true,
                                "name": "FX Outgoing Wire Fee",
                                "defaultValue": "0",
                                "hasChanged": false,
                                "tooltip": "",
                                "exceptionOptions": [
                                    {
                                        "retired": false,
                                        "visible": true,
                                        "approvedByDoubleA": null,
                                        "_id": "67aa5655c431372c57030e72"
                                    }
                                ],
                                "_id": "67aa5655c431372c57030e71",
                                "labelValue": ""
                            }
                        ],
                        "cif": "F016583",
                        "accountNumber": "7115342",
                        "visible": true,
                        "kycMailingStatus": null,
                        "_id": "67aa5655c431372c57030e70"
                    },
                    {
                        "name": "Standard Fees",
                        "code": 1,
                        "fields": [
                            {
                                "code": 4,
                                "isStandard": false,
                                "isCurrentClient": false,
                                "isException": false,
                                "name": "FX Outgoing Wire Fee",
                                "defaultValue": "25",
                                "hasChanged": false,
                                "tooltip": "",
                                "exceptionOptions": [],
                                "_id": "67aa5655c431372c57030e58"
                            },
                            {
                                "code": 4,
                                "isStandard": false,
                                "isCurrentClient": false,
                                "isException": false,
                                "name": "FX Outgoing Wire Fee",
                                "defaultValue": "",
                                "hasChanged": false,
                                "tooltip": "",
                                "exceptionOptions": [],
                                "_id": "67aa5655c431372c57030e59"
                            },
                            {
                                "code": 4,
                                "isStandard": false,
                                "isCurrentClient": false,
                                "isException": false,
                                "name": "FX Outgoing Wire Fee",
                                "defaultValue": "",
                                "hasChanged": false,
                                "tooltip": "",
                                "exceptionOptions": [],
                                "_id": "67aa5655c431372c57030e5a"
                            },
                            {
                                "code": 4,
                                "isStandard": false,
                                "isCurrentClient": false,
                                "isException": false,
                                "name": "FX Outgoing Wire Fee",
                                "defaultValue": "25",
                                "hasChanged": false,
                                "tooltip": "",
                                "exceptionOptions": [],
                                "_id": "67aa5655c431372c57030e5b"
                            }
                        ],
                        "cif": "F016583",
                        "accountNumber": "7115431",
                        "visible": true,
                        "kycMailingStatus": null,
                        "_id": "67aa5655c431372c57030e57"
                    },
                    {
                        "name": "Client Current Fees",
                        "code": 2,
                        "fields": [
                            {
                                "code": 4,
                                "isStandard": false,
                                "isCurrentClient": false,
                                "isException": false,
                                "name": "FX Outgoing Wire Fee",
                                "defaultValue": "",
                                "hasChanged": false,
                                "tooltip": "",
                                "exceptionOptions": [],
                                "_id": "67aa5655c431372c57030e6c"
                            },
                            {
                                "code": 4,
                                "isStandard": false,
                                "isCurrentClient": false,
                                "isException": false,
                                "name": "FX Outgoing Wire Fee",
                                "defaultValue": "",
                                "hasChanged": false,
                                "tooltip": "",
                                "exceptionOptions": [],
                                "_id": "67aa5655c431372c57030e6d"
                            },
                            {
                                "code": 4,
                                "isStandard": false,
                                "isCurrentClient": false,
                                "isException": false,
                                "name": "FX Outgoing Wire Fee",
                                "defaultValue": "",
                                "hasChanged": false,
                                "tooltip": "",
                                "exceptionOptions": [],
                                "_id": "67aa5655c431372c57030e6e"
                            },
                            {
                                "code": 4,
                                "isStandard": false,
                                "isCurrentClient": false,
                                "isException": false,
                                "name": "FX Outgoing Wire Fee",
                                "defaultValue": "",
                                "hasChanged": false,
                                "tooltip": "",
                                "exceptionOptions": [],
                                "_id": "67aa5655c431372c57030e6f"
                            }
                        ],
                        "cif": "F016583",
                        "accountNumber": "7115431",
                        "visible": true,
                        "kycMailingStatus": null,
                        "_id": "67aa5655c431372c57030e6b"
                    },
                    {
                        "name": "Exceptions Request",
                        "code": 3,
                        "fields": [
                            {
                                "code": 4,
                                "isStandard": false,
                                "isCurrentClient": false,
                                "isException": true,
                                "name": "FX Outgoing Wire Fee",
                                "defaultValue": "0",
                                "hasChanged": false,
                                "tooltip": "",
                                "exceptionOptions": [
                                    {
                                        "retired": false,
                                        "visible": true,
                                        "approvedByDoubleA": null,
                                        "_id": "67aa5655c431372c57030e7b"
                                    }
                                ],
                                "_id": "67aa5655c431372c57030e7a",
                                "labelValue": ""
                            }
                        ],
                        "cif": "F016583",
                        "accountNumber": "7115431",
                        "visible": true,
                        "kycMailingStatus": null,
                        "_id": "67aa5655c431372c57030e79"
                    },
                    {
                        "name": "Standard Fees",
                        "code": 1,
                        "fields": [
                            {
                                "code": 4,
                                "isStandard": false,
                                "isCurrentClient": false,
                                "isException": false,
                                "name": "FX Outgoing Wire Fee",
                                "defaultValue": "25",
                                "hasChanged": false,
                                "tooltip": "",
                                "exceptionOptions": [],
                                "_id": "67aa5655c431372c57030e4e"
                            },
                            {
                                "code": 4,
                                "isStandard": false,
                                "isCurrentClient": false,
                                "isException": false,
                                "name": "FX Outgoing Wire Fee",
                                "defaultValue": "",
                                "hasChanged": false,
                                "tooltip": "",
                                "exceptionOptions": [],
                                "_id": "67aa5655c431372c57030e4f"
                            },
                            {
                                "code": 4,
                                "isStandard": false,
                                "isCurrentClient": false,
                                "isException": false,
                                "name": "FX Outgoing Wire Fee",
                                "defaultValue": "",
                                "hasChanged": false,
                                "tooltip": "",
                                "exceptionOptions": [],
                                "_id": "67aa5655c431372c57030e50"
                            },
                            {
                                "code": 4,
                                "isStandard": false,
                                "isCurrentClient": false,
                                "isException": false,
                                "name": "FX Outgoing Wire Fee",
                                "defaultValue": "25",
                                "hasChanged": false,
                                "tooltip": "",
                                "exceptionOptions": [],
                                "_id": "67aa5655c431372c57030e51"
                            }
                        ],
                        "cif": "F016583",
                        "accountNumber": "7115822",
                        "visible": true,
                        "kycMailingStatus": null,
                        "_id": "67aa5655c431372c57030e4d"
                    },
                    {
                        "name": "Client Current Fees",
                        "code": 2,
                        "fields": [
                            {
                                "code": 4,
                                "isStandard": false,
                                "isCurrentClient": false,
                                "isException": false,
                                "name": "FX Outgoing Wire Fee",
                                "defaultValue": "",
                                "hasChanged": false,
                                "tooltip": "",
                                "exceptionOptions": [],
                                "_id": "67aa5655c431372c57030e62"
                            },
                            {
                                "code": 4,
                                "isStandard": false,
                                "isCurrentClient": false,
                                "isException": false,
                                "name": "FX Outgoing Wire Fee",
                                "defaultValue": "",
                                "hasChanged": false,
                                "tooltip": "",
                                "exceptionOptions": [],
                                "_id": "67aa5655c431372c57030e63"
                            },
                            {
                                "code": 4,
                                "isStandard": false,
                                "isCurrentClient": false,
                                "isException": false,
                                "name": "FX Outgoing Wire Fee",
                                "defaultValue": "",
                                "hasChanged": false,
                                "tooltip": "",
                                "exceptionOptions": [],
                                "_id": "67aa5655c431372c57030e64"
                            },
                            {
                                "code": 4,
                                "isStandard": false,
                                "isCurrentClient": false,
                                "isException": false,
                                "name": "FX Outgoing Wire Fee",
                                "defaultValue": "",
                                "hasChanged": false,
                                "tooltip": "",
                                "exceptionOptions": [],
                                "_id": "67aa5655c431372c57030e65"
                            }
                        ],
                        "cif": "F016583",
                        "accountNumber": "7115822",
                        "visible": true,
                        "kycMailingStatus": null,
                        "_id": "67aa5655c431372c57030e61"
                    },
                    {
                        "name": "Exceptions Request",
                        "code": 3,
                        "fields": [
                            {
                                "code": 4,
                                "isStandard": false,
                                "isCurrentClient": false,
                                "isException": true,
                                "name": "FX Outgoing Wire Fee",
                                "defaultValue": "0",
                                "hasChanged": false,
                                "tooltip": "",
                                "exceptionOptions": [
                                    {
                                        "retired": false,
                                        "visible": true,
                                        "approvedByDoubleA": null,
                                        "_id": "67aa5655c431372c57030e75"
                                    }
                                ],
                                "_id": "67aa5655c431372c57030e74",
                                "labelValue": ""
                            }
                        ],
                        "cif": "F016583",
                        "accountNumber": "7115822",
                        "visible": true,
                        "kycMailingStatus": null,
                        "_id": "67aa5655c431372c57030e73"
                    }
                ]
            }
        ],
        "accounts": [
            {
                "cifno": "F016583",
                "ddaNumber": 7115342,
                "branchCity": "New York",
                "branchState": "NY",
                "branchType": "Domestic",
                "defaultPackageType": "Individual",
                "feePackage": "Domestic Individual"
            },
            {
                "cifno": "F016583",
                "ddaNumber": 7115342,
                "branchCity": "New York",
                "branchState": "NY",
                "branchType": "Domestic",
                "defaultPackageType": "Individual",
                "feePackage": "Domestic Individual"
            },
            {
                "cifno": "F016583",
                "ddaNumber": 7115342,
                "branchCity": "New York",
                "branchState": "NY",
                "branchType": "Domestic",
                "defaultPackageType": "Individual",
                "feePackage": "Domestic Individual"
            },
            {
                "cifno": "F016583",
                "ddaNumber": 7115342,
                "branchCity": "New York",
                "branchState": "NY",
                "branchType": "Domestic",
                "defaultPackageType": "Individual",
                "feePackage": "Domestic Individual"
            },
            {
                "cifno": "F016583",
                "ddaNumber": 7115342,
                "branchCity": "New York",
                "branchState": "NY",
                "branchType": "Domestic",
                "defaultPackageType": "Individual",
                "feePackage": "Domestic Individual"
            },
            {
                "cifno": "F016583",
                "ddaNumber": 7115342,
                "branchCity": "New York",
                "branchState": "NY",
                "branchType": "Domestic",
                "defaultPackageType": "Individual",
                "feePackage": "Domestic Individual"
            },
            {
                "cifno": "F016583",
                "ddaNumber": 7115822,
                "branchCity": "New York",
                "branchState": "NY",
                "branchType": "Domestic",
                "defaultPackageType": "Individual",
                "feePackage": "Domestic Individual"
            },
            {
                "cifno": "F016583",
                "ddaNumber": 7115822,
                "branchCity": "New York",
                "branchState": "NY",
                "branchType": "Domestic",
                "defaultPackageType": "Individual",
                "feePackage": "Domestic Individual"
            },
            {
                "cifno": "F016583",
                "ddaNumber": 7115822,
                "branchCity": "New York",
                "branchState": "NY",
                "branchType": "Domestic",
                "defaultPackageType": "Individual",
                "feePackage": "Domestic Individual"
            },
            {
                "cifno": "F016583",
                "ddaNumber": 7115822,
                "branchCity": "New York",
                "branchState": "NY",
                "branchType": "Domestic",
                "defaultPackageType": "Individual",
                "feePackage": "Domestic Individual"
            },
            {
                "cifno": "F016583",
                "ddaNumber": 7115822,
                "branchCity": "New York",
                "branchState": "NY",
                "branchType": "Domestic",
                "defaultPackageType": "Individual",
                "feePackage": "Domestic Individual"
            },
            {
                "cifno": "F016583",
                "ddaNumber": 7115822,
                "branchCity": "New York",
                "branchState": "NY",
                "branchType": "Domestic",
                "defaultPackageType": "Individual",
                "feePackage": "Domestic Individual"
            },
            {
                "cifno": "F016583",
                "ddaNumber": 7115822,
                "branchCity": "New York",
                "branchState": "NY",
                "branchType": "Domestic",
                "defaultPackageType": "Individual",
                "feePackage": "Domestic Individual"
            },
            {
                "cifno": "F016583",
                "ddaNumber": 7115342,
                "branchCity": "New York",
                "branchState": "NY",
                "branchType": "Domestic",
                "defaultPackageType": "Individual",
                "feePackage": "Domestic Individual"
            },
            {
                "cifno": "F016583",
                "ddaNumber": 7113617,
                "branchCity": "New York",
                "branchState": "NY",
                "branchType": "Domestic",
                "defaultPackageType": "Individual",
                "feePackage": "Domestic Individual"
            },
            {
                "cifno": "F016583",
                "ddaNumber": 7113617,
                "branchCity": "New York",
                "branchState": "NY",
                "branchType": "Domestic",
                "defaultPackageType": "Individual",
                "feePackage": "Domestic Individual"
            },
            {
                "cifno": "F016583",
                "ddaNumber": 7113617,
                "branchCity": "New York",
                "branchState": "NY",
                "branchType": "Domestic",
                "defaultPackageType": "Individual",
                "feePackage": "Domestic Individual"
            },
            {
                "cifno": "F016583",
                "ddaNumber": 7113617,
                "branchCity": "New York",
                "branchState": "NY",
                "branchType": "Domestic",
                "defaultPackageType": "Individual",
                "feePackage": "Domestic Individual"
            },
            {
                "cifno": "F016583",
                "ddaNumber": 7113617,
                "branchCity": "New York",
                "branchState": "NY",
                "branchType": "Domestic",
                "defaultPackageType": "Individual",
                "feePackage": "Domestic Individual"
            },
            {
                "cifno": "F016583",
                "ddaNumber": 7113617,
                "branchCity": "New York",
                "branchState": "NY",
                "branchType": "Domestic",
                "defaultPackageType": "Individual",
                "feePackage": "Domestic Individual"
            },
            {
                "cifno": "F016583",
                "ddaNumber": 7115431,
                "branchCity": "New York",
                "branchState": "NY",
                "branchType": "Domestic",
                "defaultPackageType": "Individual",
                "feePackage": "Domestic Individual"
            },
            {
                "cifno": "F016583",
                "ddaNumber": 7115431,
                "branchCity": "New York",
                "branchState": "NY",
                "branchType": "Domestic",
                "defaultPackageType": "Individual",
                "feePackage": "Domestic Individual"
            },
            {
                "cifno": "F016583",
                "ddaNumber": 7115431,
                "branchCity": "New York",
                "branchState": "NY",
                "branchType": "Domestic",
                "defaultPackageType": "Individual",
                "feePackage": "Domestic Individual"
            },
            {
                "cifno": "F016583",
                "ddaNumber": 7115431,
                "branchCity": "New York",
                "branchState": "NY",
                "branchType": "Domestic",
                "defaultPackageType": "Individual",
                "feePackage": "Domestic Individual"
            },
            {
                "cifno": "F016583",
                "ddaNumber": 7115431,
                "branchCity": "New York",
                "branchState": "NY",
                "branchType": "Domestic",
                "defaultPackageType": "Individual",
                "feePackage": "Domestic Individual"
            },
            {
                "cifno": "F016583",
                "ddaNumber": 7115431,
                "branchCity": "New York",
                "branchState": "NY",
                "branchType": "Domestic",
                "defaultPackageType": "Individual",
                "feePackage": "Domestic Individual"
            }
        ],
        "feesActives": []
    }
}



import Result from '#features/shared/result.js';
import CustomerFees from '#src/models/CustomerFees.js';
import BankAccountFee from '#src/models/BankAccountFee.js';
import { FeeCase } from '#src/models/entities/FeeCase.js';
import {
  connectToFeeMgmtDb,
  executeStoreProcedure,
} from '#core/data/mssql/index.js';

const deParaFeeCodes = {
  JH001: 1,
  JH002: 2,
  JH006: 4,
  JH007: 8,
  BPS002: 6,
  BPS003: 5,
  BPS004: 7,
  BPS005: 7,
  JH010: 3,
};

const deParaFeePackageId = {
  1: 'intlPB3',
  2: 'uSPBIndividual3',
  3: 'uSPBCorporation3',
  4: 'efraPB3',
  5: 'eraPB3',
};

const excludedCodes = new Set([8]);

export default class FeeGetByCifUseCase {
  async execute({ customerAccount }) {
    const result = { fees: [] };

    const { groupedFees, accounts } = await this.#getFeesStructuredFromSQL(
      customerAccount
    );

    result.accounts = accounts.map((account) => ({
      cifno: account.cifno,
      ddaNumber: account.ddaNumber,
      branchCity: account.branchCity,
      branchState: account.branchState, 
      branchType: account.branchType, 
      defaultPackageType: account.defaultPackageType, 
      feePackage: account.feePackage, 
    }));

    const customer = new CustomerFees(groupedFees, accounts);
    if (customer.fee) result.fees.push(customer.fee);

    const bank = new BankAccountFee(groupedFees, accounts);
    if (bank.fee) result.fees.push(bank.fee);


    let investmentGroup = groupedFees['Investment Account Fees'];
    if (investmentGroup) {
      const equityFields = accounts.filter((account) => account.feeType === 3);
      equityFields.forEach((field) => {
        let investmentGroupFields = investmentGroup.feeGroups.find((group) => group.name === 'Standard Fees');
        if (!investmentGroupFields) {
          investmentGroupFields = {
            name: 'Standard Fees',
            code: 1,
            fields: [],
          };
          investmentGroup.feeGroups.push(investmentGroupFields);
        }

        investmentGroupFields.fields.push({
          code: field.code,
          name: field.name || 'Equity and Options Commission',
          defaultValue: field.defaultValue || '',
          tooltip: field.tooltip || '',
          isException: field.isException || false,
        });
      });

      result.fees.push(investmentGroup);
    }


    const feesActives = await FeeCase.find({
      cif: customerAccount[0].cifno,
      status: {
        $nin: ['DONE', 'REJECTED'],
      },
      caseNumber: {
        $exists: true,
      },
    });

    result.feesActives = feesActives?.map((x) => ({
      caseNumber: x.caseNumber,
      id: x.id,
    }));


    return Result.ok(result);
  }


async #getFeesStructuredFromSQL(customerAccount) {
  const feesData = await this.#getFeesFromSQL(customerAccount[0].cifno);

  const feePackageId = feesData[0]?.['Default Fee Package Id'];
  if (!feePackageId) {
      throw new Error('Default Fee Package Id not found in feesData');
  }

  const documentUrl = this.#getDocumentUrl(feePackageId);

  const accounts = feesData.map((fee) => ({
      cifno: fee.CIFNO,
      ddaNumber: fee.ACCTNO,
      branchCity: fee['Branch City'],
      branchState: fee['Branch State'],
      branchType: fee['Branch Type'],
      defaultPackageType: fee['Default Package Type'],
      feePackage: fee['Default Fee Package']?.trim() || '',
      defaultFeePackageId: fee['Default Fee Package Id'] || '',
      feeType: this.#mapFeeType(fee.FeeType),
      feeGroup: 1,
      kycMailingStatus: fee.StandardException === 'Standard' ? 'Standard' : 'Hold Mail',
      documentUrl,
  }));

  const groupedFees = {};

  for (const fee of feesData) {
      const {
          FeeType,
          FeeDescription,
          FeeCode,
          FeeAmount,
          Frequency,
          DefaultFeeAmount,
          DefaultFrequency,
      } = fee;

      const mappedCode = deParaFeeCodes[FeeCode] || FeeCode;

      if (
          (FeeType === 'Customer Fees' && ![1, 2].includes(mappedCode)) ||
          (FeeType === 'Bank Account Fees' && ![3, 4].includes(mappedCode)) ||
          (FeeType === 'Investment Account Fees' && ![5, 6, 7].includes(mappedCode)) ||
          excludedCodes.has(mappedCode) 
      ) {
          continue;
      }

      if (!groupedFees[FeeType]) {
          groupedFees[FeeType] = {
              feeType: FeeType,
              feeGroups: [],
          };
      }

      let standardGroup = groupedFees[FeeType].feeGroups.find(
          (group) => group.name === 'Standard Fees'
      );
      if (!standardGroup) {
          standardGroup = {
              name: 'Standard Fees',
              code: 1,
              fields: [],
          };
          groupedFees[FeeType].feeGroups.push(standardGroup);
      }

      standardGroup.fields.push({
          code: mappedCode,
          name: FeeDescription,
          defaultValue: FeeAmount ? FeeAmount.toString() : '',
          tooltip: Frequency ? Frequency : '',
          isException: false,
      });

      let clientCurrentGroup = groupedFees[FeeType].feeGroups.find(
          (group) => group.name === 'Client Current Fees'
      );
      if (!clientCurrentGroup) {
          clientCurrentGroup = {
              name: 'Client Current Fees',
              code: 2,
              fields: [],
          };
          groupedFees[FeeType].feeGroups.push(clientCurrentGroup);
      }

      clientCurrentGroup.fields.push({
          code: mappedCode,
          name: FeeDescription,
          defaultValue: DefaultFeeAmount ? DefaultFeeAmount.toString() : '',
          tooltip: DefaultFrequency ? DefaultFrequency : '',
          isException: false,
      });
  }

  const exceptions = await this.#getExceptionFeesFromSQL(feePackageId);
  
  for (const exception of exceptions) {
      const { code, name, defaultValue, tooltip, isException } = exception;

      const feeType = Object.keys(groupedFees).find((type) =>
          groupedFees[type].feeGroups.some((group) =>
              group.fields.some((field) => field.code === code)
          )
      );

      if (!feeType) {
          continue;
      }

      let exceptionGroup = groupedFees[feeType]?.feeGroups.find(
          (group) => group.name === 'Exceptions Request'
      );

      if (!exceptionGroup) {
          exceptionGroup = {
              name: 'Exceptions Request',
              code: 3,
              fields: [],
          };
          groupedFees[feeType]?.feeGroups.push(exceptionGroup);
      }

      let existingField = exceptionGroup.fields.find(field => field.code === code);

      if (!existingField) {
          existingField = {
              code,
              name,
              defaultValue,
              tooltip,
              isException,
              exceptionOptions: [] 
          };
          exceptionGroup.fields.push(existingField);
      }

      existingField.exceptionOptions.push({
          code,
          name,
          defaultValue,
          tooltip,
          isException

          // value: Amount.toString(),
          // text: $${parseFloat(Amount).toFixed(2)},
          // retired: false,
          // visible: true,
          // approvedByDoubleA: null,
          // _id: FeeParameterOptionId,
      });
      
  }

  return { groupedFees: Object.values(groupedFees), accounts };
}


#getDocumentUrl(feePackageId) {

  const packageKeyMap = {
    1: 'intlPB3',
    2: 'uSPBIndividual3',
    3: 'uSPBCorporation3',
    4: 'efraPB3',
    5: 'eraPB3',
  };
  const packageKey = packageKeyMap[feePackageId]
  return packageKey ? global.environment.scheduleUrls?.[feePackageId] || '' : '';
}

  #mapFeeType(feeType) {
    switch (feeType) {
      case 'Customer Fees':
        return 1;
      case 'Bank Account Fees':
        return 2;
      case 'Investment Account Fees':
        return 3;
      default:
        return 0;
    }
  }

  async #getFeesFromSQL(cifno) {
    const connection = await connectToFeeMgmtDb();
    return executeStoreProcedure(connection, 'sp_get_fees_byCIF', { cifno });
  }

  async #getExceptionFeesFromSQL(feePackageId) {
    const connection = await connectToFeeMgmtDb();
    const data = await executeStoreProcedure(
      connection,
      'sp_get_exception_fees_bypackage',
      { feePackageId }
    );

    return data.map((exception) => ({
      code: deParaFeeCodes[exception.FeeCode] || exception.FeeCode,
      name: exception.FeeDescription,
      defaultValue: exception.Amount?.toString() || '0',
      tooltip: exception.FreqDescription || '',
      isException: true,
    }));
  }
}



import { FeeGroup } from './entities/FeeGroups.js'
import numberToCurrency from '../core/helpers/currency.js'

export default class BankAccountFee {
  #feeName = 'Bank Account Fees'
  #bank = {}
  #accounts = []
  #accountsDDA = []
  constructor(fees, accounts) {
    // Validar fees
    if (!fees || !Array.isArray(fees) || fees.length === 0) {
      throw new Error('Fees is empty or undefined');
    }

    console.log('FEES >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>',fees)
  
    // Encontrar Bank Account Fees
    this.#bank = fees.filter((x) => x.feeType === this.#feeName)[0];
    if (!this.#bank || !Array.isArray(this.#bank.feeGroups)) {
      throw new Error('Bank Account Fees or feeGroups are undefined');
    }
  
    // Validar accounts
    if (!accounts || !Array.isArray(accounts) || accounts.length === 0) {
      throw new Error('Accounts is empty or undefined');
    }
  
    // Filtrar contas e DDA
    const feeGroupCode = this.#bank.feeGroups[0].code;
    this.#accounts = accounts.filter((x) => x.feeGroup === feeGroupCode);
    this.#accountsDDA = new Set(
      accounts
        .filter((x) => x.feeGroup === feeGroupCode)
        .map((x) => x.ddaNumber)
    );
  
    if (this.#accounts.length === 0) {
      throw new Error('No accounts matched with Bank Account Fees feeGroup');
    }
  
    // Adicionar mltiplas contas e valores atuais
    this.#addMultiplesAccount(this.#accounts[0].cifno);
    this.#addCurrentClientValue();
  }
  
  #addMultiplesAccount(cif) {
    if (!this.#accounts || this.#accounts.length < 1) {
      this.#bank = {};
      return;
    }
  
    const result = {};
    for (const feeGroup of this.#bank.feeGroups) {
      if (!feeGroup.fields || !Array.isArray(feeGroup.fields)) {
        console.warn(`FeeGroup ${feeGroup.name} has no fields`);
        continue;
      }
  
      for (const numberAccount of this.#accountsDDA) {
        if (!result[numberAccount]) result[numberAccount] = [];
  
        feeGroup.fields.forEach((item) => {
          item.exceptionOptions = item.exceptionOptions?.filter(
            (x) => !x.retired
          ) || [];
        });
  
        const newFeeGroup = new FeeGroup({
          name: feeGroup.name,
          fields: feeGroup.fields,
          cif,
          accountNumber: numberAccount,
          visible: feeGroup.visible,
          code: feeGroup.code
        });
  
        result[numberAccount].push(newFeeGroup);
      }
    }
  
    const feeGroupsByAccount = Object.keys(result).map((item) => result[item]);
    this.#bank.feeGroups = [];
    for (const feeGroups of feeGroupsByAccount) {
      this.#bank.feeGroups.push(...feeGroups);
    }
  }
  
  
  #addCurrentClientValue() {
    if (!this.#accounts || this.#accounts.length < 1) {
      this.#bank = {};
      return;
    }
  
    for (const [feeGroupIndex, feeGroup] of this.#bank.feeGroups.entries()) {
      feeGroup.cif = this.#accounts[0]?.cifno || null;
      for (const [fieldIndex, field] of feeGroup.fields.entries()) {
        if (field.isException) {
          const previousGroup = this.#bank.feeGroups[feeGroupIndex - 1];
          if (previousGroup) {
            field.labelValue =
              previousGroup.fields[fieldIndex]?.labelValue || '';
          }
        } else {
          for (const account of this.#accounts) {
            if (
              field.code === account.feeType &&
              feeGroup.accountNumber === account.ddaNumber.toString()
            ) {
              if (field.isCurrentClient) {
                field.defaultValue = account.feeAmount?.toString() || '';
              }
              field.labelValue = numberToCurrency(field.defaultValue);
            }
          }
        }
      }
    }
  
    this.#clearMemory();
  }

  get fee() {
    return this.#bank
  }

 

  #clearMemory() {
    this.#accounts = []
    this.#accountsDDA = []
  }
}



import numberToCurrency from '../core/helpers/currency.js'

export default class CustomerFees {
  #feeName = 'Customer Fees'
  #customer = {}
  #accounts = []
  #clientCurrent = []
  constructor(fees, accounts) {
    // Validar fees
    if (!fees || !Array.isArray(fees) || fees.length === 0) {
      throw new Error('Fees is empty or undefined');
    }
  
    // Encontrar Customer Fees
    this.#customer = fees.filter((x) => x.feeType === this.#feeName)[0];
  
    if (!this.#customer || !Array.isArray(this.#customer.feeGroups)) {
      throw new Error('Customer Fees or feeGroups are undefined');
    }
  
    // Processar feeGroups
    this.#customer.feeGroups.forEach((feeGroup) => {
      feeGroup.fields = feeGroup.fields.filter((x) => x.code <= accounts.reduce((acc, item) => {
        if (item.feeType > 2) return acc;
        acc = item.feeType;
        return acc;
      }, 0));
  
      feeGroup.fields?.forEach((item) => {
        item.exceptionOptions = item.exceptionOptions?.filter((x) => !x.retired) || [];
      });
    });
  
    this.#accounts = accounts.filter(
      (x) => x.feeGroup === this.#customer.feeGroups[0].code
    );
  
    this.#customer.feeGroups[0].kycMailingStatus =
      accounts.find((account) => account.feeType === 2)?.kycMailingStatus || null;
  
    this.#customer.feeGroups[0].fields.forEach((field) => {
      field.labelValue = numberToCurrency(field.defaultValue);
    });
  
    // Verificar Client Current
    if (this.#customer.feeGroups.length > 1) {
      this.#clientCurrent = this.#customer.feeGroups[1].fields;
      this.#configureCustomer();
    } else {
      console.warn('Client Current group is missing');
    }
  
    // Verificar Exceptions
    if (this.#customer.feeGroups.length > 2) {
      this.#customer.feeGroups[2].fields.forEach((field, fieldIndex) => {
        field.labelValue =
          this.#customer.feeGroups[1]?.fields[fieldIndex]?.labelValue || '';
        if (
          field.code === 2 &&
          this.#customer.feeGroups[0].kycMailingStatus !== 'Hold Mail'
        ) {
          field.defaultValue = field.labelValue;
          field.exceptionOptions = [
            {
              value: field.defaultValue,
              text: field.defaultValue
            }
          ];
        }
      });
    } else {
      console.warn('Exception group is missing');
    }
  }
  get fee() {
    return this.#customer
  }

  #configureCustomer() {
    // global.logger.info('configureCustomer()')

    if (this.#accounts && this.#accounts.length < 1) {
      this.#customer = {}
      return
    }

    for (const field of this.#clientCurrent) {
      for (const account of this.#accounts) {
        if (field.isCurrentClient && field.code === account.feeType) {
          if (
            field.code === 2 &&
            this.#customer.feeGroups[0].kycMailingStatus !== 'Hold Mail'
          ) {
            field.defaultValue = 'NOT APPLICABLE'
            field.labelValue = field.defaultValue
          } else {
            field.defaultValue = account.feeAmount.toString()
            field.labelValue = numberToCurrency(field.defaultValue)
          }
        }
      }
    }

    for (const feeGroup of this.#customer.feeGroups) {
      feeGroup.cif = this.#accounts[0].cifno
      feeGroup.accountNumber = this.#accounts[0].ddaNumber
    }

    this.#clearMemory()
  }

  #clearMemory() {
    this.#accounts = []
    this.#clientCurrent = []
  }
}
 







