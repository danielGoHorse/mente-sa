/* helper p/ Equity + Option  ───────────── */
function mergeEquityOption(rows) {
  /*
   * Agrupa pelo código (Amount) — “A1”, “B6”, “E3”… — em vez do
   * FeeParameterOptionId, assim eliminamos duplicados.
   */
  const bucket = {};
  for (const r of rows) {
    const code = r.Amount;                  // ← chave agora é o código
    (bucket[code] ??= { eq: null, op: null });
    if (r.BPSFeeTypeCode === 'E') bucket[code].eq = r;
    if (r.BPSFeeTypeCode === 'O') bucket[code].op = r;
  }

  /* monta opções ordenadas pelo código alfanumérico */
  return Object.keys(bucket)
    .sort((a, b) => a.localeCompare(b))
    .map(code => {
      const { eq, op } = bucket[code];
      return {
        value  : code,                                    // A1, B6…
        text   : `${code} - ` +
                 `Equity:${eq ? eq.FreqDescription : '-' }; ` +
                 `Option:${op ? op.FreqDescription : '-'}`,
        visible: true,
        retired: false
      };
    });
}
